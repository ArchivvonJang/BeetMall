<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.beetmall.sshj.custom.dao.CategoryDAO">
	<select id="categoryOnetotalRecord" parameterType="com.beetmall.sshj.custom.vo.PageSearchVO" resultType="int">
		select count(productnum) from(
	        select a.productnum, a.productname, a.productprice, a.thumbimg, c.username, d.storeaddr, e.saleprice, 
							e.salestart, e.salefinish, avg(reviewscore) as totalscore, count(b.productnum) as sumreview, productprice-nvl(saleprice, 0) as proprice
					from product a 
					    join review b 
					        on a.productnum=b.productnum 
					    join member c
					        on c.userid=a.userid
					    join seller d
					        on d.userid=a.userid
					    left outer join discount e
					        on e.productnum=a.productnum
					group by a.productnum, a.productname, a.productprice, a.thumbimg, c.username, d.storeaddr, e.saleprice, e.salestart, e.salefinish
					order by productnum)
	</select>
	
	<select id="mapAllRecord" resultType="com.beetmall.sshj.custom.vo.CategoryFarmVO">
		select a.storenum, a.farmname, a.farmintro, a.farmprofile, a.productnum, b.storeaddr 
		from farm a 
		join seller b 
		on a.storenum = b.storenum
	</select>
	<select id="categorylist" resultType="com.beetmall.sshj.custom.vo.CategoryVO" parameterType="com.beetmall.sshj.custom.vo.PageSearchVO">
		select * from(
	    	select * from(
				select a.productnum, a.productname, a.productprice, a.thumbimg, c.username, d.storeaddr, e.saleprice, 
						e.salestart, e.salefinish, avg(reviewscore) as totalscore, count(b.productnum) as sumreview, productprice-nvl(saleprice, 0) as proprice
				from product a 
				    join review b 
				        on a.productnum=b.productnum 
				    join member c
				        on c.userid=a.userid
				    join seller d
				        on d.userid=a.userid
				    left outer join discount e
				        on e.productnum=a.productnum
				group by a.productnum, a.productname, a.productprice, a.thumbimg, c.username, d.storeaddr, e.saleprice, e.salestart, e.salefinish
				order by productnum desc)
			where <![CDATA[rownum<=]]>${pageNum}*${onePageRecord} order by productnum)
			where <![CDATA[rownum<=]]><if test="pageNum==totalPage">${lastPageRecord}</if>
        							  <if test="pageNum!=totalPage">${onePageRecord}</if>
        order by productnum desc
	</select>
	<!-- <select id="pickupCheckTure" resultType="com.beetmall.sshj.custom.vo.CategoryVO">
		select a.productnum, a.productname, a.productprice, a.thumbimg, c.username, d.storeaddr, e.saleprice, 
				e.salestart, e.salefinish, avg(reviewscore) as totalscore, count(b.productnum) as sumreview, productprice-nvl(saleprice, 0) as proprice
		from product a 
		    join review b 
		        on a.productnum=b.productnum 
		    join member c
		        on c.userid=a.userid
		    join seller d
		        on d.userid=a.userid
		    left outer join discount e
		        on e.productnum=a.productnum
            where a.deliveryoption='1' or a.deliveryoption='3'
		group by a.productnum, a.productname, a.productprice, a.thumbimg, c.username, d.storeaddr, e.saleprice, e.salestart, e.salefinish
		order by productnum
	</select>
	<select id="highhigh1" resultType="com.beetmall.sshj.custom.vo.CategoryVO">
		select a.productnum, a.productname, a.productprice, a.thumbimg, c.username, d.storeaddr, e.saleprice, 
				e.salestart, e.salefinish, avg(reviewscore) as totalscore, count(b.productnum) as sumreview, productprice-nvl(saleprice, 0) as proprice
		from product a 
		    join review b 
		        on a.productnum=b.productnum 
		    join member c
		        on c.userid=a.userid
		    join seller d
		        on d.userid=a.userid
		    left outer join discount e
		        on e.productnum=a.productnum
		group by a.productnum, a.productname, a.productprice, a.thumbimg, c.username, d.storeaddr, e.saleprice, e.salestart, e.salefinish
		order by totalscore desc
	</select>
	<select id="lowlow1" resultType="com.beetmall.sshj.custom.vo.CategoryVO">
		select a.productnum, a.productname, a.productprice, a.thumbimg, c.username, d.storeaddr, e.saleprice, 
				e.salestart, e.salefinish, avg(reviewscore) as totalscore, count(b.productnum) as sumreview, productprice-nvl(saleprice, 0) as proprice
		from product a 
		    join review b 
		        on a.productnum=b.productnum 
		    join member c
		        on c.userid=a.userid
		    join seller d
		        on d.userid=a.userid
		    left outer join discount e
		        on e.productnum=a.productnum
		group by a.productnum, a.productname, a.productprice, a.thumbimg, c.username, d.storeaddr, e.saleprice, e.salestart, e.salefinish
		order by totalscore
	</select> -->
	<select id="uglyItem" resultType="com.beetmall.sshj.custom.vo.CategoryVO" parameterType="com.beetmall.sshj.custom.vo.PageSearchVO">
		select * from(
	    	select * from(
				select a.productnum, a.productname, a.productprice, a.thumbimg, c.username, d.storeaddr, e.saleprice, 
						e.salestart, e.salefinish, avg(reviewscore) as totalscore, count(b.productnum) as sumreview, productprice-nvl(saleprice, 0) as proprice
				from product a 
				    join review b 
				        on a.productnum=b.productnum 
				    join member c
				        on c.userid=a.userid
				    join seller d
				        on d.userid=a.userid
				    left outer join discount e
				        on e.productnum=a.productnum
				group by a.productnum, a.productname, a.productprice, a.thumbimg, c.username, d.storeaddr, e.saleprice, e.salestart, e.salefinish
				order by productnum desc)
			where <![CDATA[rownum<=]]>${pageNum}*${onePageRecord} order by productnum)
			where <![CDATA[rownum<=]]><if test="pageNum==totalPage">${lastPageRecord}</if>
        							  <if test="pageNum!=totalPage">${onePageRecord}</if>
        order by productnum desc
	</select>
	
	<select id="payCategory" resultType="com.beetmall.sshj.custom.vo.CategoryVO" parameterType="com.beetmall.sshj.custom.vo.PageSearchVO">
		select * from(
	    	select * from(
				select a.productnum, a.productname, a.productprice, a.thumbimg, c.username, d.storeaddr, e.saleprice, 
						e.salestart, e.salefinish, avg(reviewscore) as totalscore, count(b.productnum) as sumreview, productprice-nvl(saleprice, 0) as proprice
				from product a 
				    join review b 
				        on a.productnum=b.productnum 
				    join member c
				        on c.userid=a.userid
				    join seller d
				        on d.userid=a.userid
				    left outer join discount e
				        on e.productnum=a.productnum
				group by a.productnum, a.productname, a.productprice, a.thumbimg, c.username, d.storeaddr, e.saleprice, e.salestart, e.salefinish
				order by productnum desc)
			where <![CDATA[rownum<=]]>${pageNum}*${onePageRecord} order by productnum)
			where <![CDATA[rownum<=]]><if test="pageNum==totalPage">${lastPageRecord}</if>
        							  <if test="pageNum!=totalPage">${onePageRecord}</if>
        order by productnum desc
	</select>
	
	<select id="categoryCharge" resultType="com.beetmall.sshj.custom.vo.CategoryVO" parameterType="com.beetmall.sshj.custom.vo.PageSearchVO">
		select * from(
	    	select * from(
				select a.productnum, a.productname, a.productprice, a.thumbimg, c.username, d.storeaddr, e.saleprice, 
						e.salestart, e.salefinish, avg(reviewscore) as totalscore, count(b.productnum) as sumreview, productprice-nvl(saleprice, 0) as proprice
				from product a 
				    join review b 
				        on a.productnum=b.productnum 
				    join member c
				        on c.userid=a.userid
				    join seller d
				        on d.userid=a.userid
				    left outer join discount e
				        on e.productnum=a.productnum
				group by a.productnum, a.productname, a.productprice, a.thumbimg, c.username, d.storeaddr, e.saleprice, e.salestart, e.salefinish
				order by productnum desc)
			where <![CDATA[rownum<=]]>${pageNum}*${onePageRecord} order by productnum)
			where <![CDATA[rownum<=]]><if test="pageNum==totalPage">${lastPageRecord}</if>
        							  <if test="pageNum!=totalPage">${onePageRecord}</if>
        order by productnum desc
	</select>
	<select id="Bestcategory" resultType="com.beetmall.sshj.custom.vo.CategoryVO" parameterType="com.beetmall.sshj.custom.vo.PageSearchVO">
		select * from(
	    	select * from(
				select a.productnum, a.productname, a.productprice, a.thumbimg, c.username, d.storeaddr, e.saleprice, 
						e.salestart, e.salefinish, avg(reviewscore) as totalscore, count(b.productnum) as sumreview, productprice-nvl(saleprice, 0) as proprice, g.ordernum
				from product a 
				    join review b 
				        on a.productnum=b.productnum 
				    join member c
				        on c.userid=a.userid
				    join seller d
				        on d.userid=a.userid
				    left outer join discount e
				        on e.productnum=a.productnum
                    join (select productnum, count(ordernum) as ordernum
                            from orderdetail
                            group by productnum
                            order by productnum) g
                        on a.productnum=g.productnum
				group by a.productnum, a.productname, a.productprice, a.thumbimg, c.username, d.storeaddr, e.saleprice, e.salestart, e.salefinish, g.ordernum
				order by productnum desc)
			where <![CDATA[rownum<=]]>${pageNum}*${onePageRecord} order by productnum)
			where <![CDATA[rownum<=]]><if test="pageNum==totalPage">${lastPageRecord}</if>
        							  <if test="pageNum!=totalPage">${onePageRecord}</if>
        order by productnum desc
	</select>
	<select id="BestcategoryOnetotalRecord" parameterType="com.beetmall.sshj.custom.vo.PageSearchVO" resultType="int">
		select count(productnum) from(
	        select a.productnum, a.productname, a.productprice, a.thumbimg, c.username, d.storeaddr, e.saleprice, 
						e.salestart, e.salefinish, avg(reviewscore) as totalscore, count(b.productnum) as sumreview, productprice-nvl(saleprice, 0) as proprice, g.ordernum
				from product a 
				    join review b 
				        on a.productnum=b.productnum 
				    join member c
				        on c.userid=a.userid
				    join seller d
				        on d.userid=a.userid
				    left outer join discount e
				        on e.productnum=a.productnum
                    join (select productnum, count(ordernum) as ordernum
                            from orderdetail
                            group by productnum
                            order by productnum) g
                        on a.productnum=g.productnum
				group by a.productnum, a.productname, a.productprice, a.thumbimg, c.username, d.storeaddr, e.saleprice, e.salestart, e.salefinish, g.ordernum
				order by productnum)
	</select>
	
</mapper>